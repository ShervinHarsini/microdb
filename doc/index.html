<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="MicroDB is a minimalistic file-based JSON object database written in PHP.">
	<meta name="keywords" content="MicroDB, Database, PHP, File-based, JSON">
	<meta name="author" content="Morris Brodersen">

	<title>MicroDB &ndash; A minimalistic file-based JSON object database written in PHP</title>

	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/bootstrap-theme.min.css" rel="stylesheet">
	<link href="css/main.css" rel="stylesheet">
	<link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/default.min.css">
</head>

<body>
	
<div id="container">
	<header id="header" role="banner">
		<h1>MicroDB</h1>
		<p>A minimalistic file-based JSON object database written in PHP</p>
		
		<nav id="nav" role="navigation">
			<ul>
				<li><b>Guide</b>
					<ul>
						<li><a href="#basics">Basics</a></li>
						<li><a href="#indices">Indices</a></li>
						<li><a href="#events">Events</a></li>
						<li><a href="#tests">Tests</a></li>
					</ul>
				</li>
			</ul>
			<ul>
				<li><b>Classes</b>
					<ul>
						<li><a href="#Database">Database</a></li>
						<li><a href="#Index">Index</a></li>
					</ul>
				</li>
			</ul>
		</nav>
	</header>

    <main id="main" role="main">
		<section id="basics" class="guide">
			<h2>Basics</h2>
			<p>The following code demonstrates all basic operations on a MicroDB database.</p>
<pre><code>&lt?php

$db = new \MicroDB\Database('data'); // data directory

// create an item
// id is an auto incrementing integer
$id = $db->create(array(
	'type' => 'post',
	'title' => 'Lorem ipsum',
	'body' => 'At vero eos et accusam et justo duo dolores et ea rebum.'
));

// load an item
$post = $db->load($id);

// save an item
$post['tags'] = array('lorem', 'ipsum');
$db->save($id, $post);

// find items
$posts = $db->find(function($post) {
	return is_array(@$post['tags']) && in_array('ipsum', @$post['tags']);
});

foreach($posts as $id => $post) {
	print_r($post);
}

// delete an item
$db->delete($id);</code></pre>
		</section>
		
		<section id="indices" class="guide">
			<h2>Indices</h2>
<p>An index maps some scalar value to one or more database IDs. This
mapping can be used to find objects more quickly.</p>
<p>Indices must be created before any database operation to work.
Usually you just create them directly after creating the database.
<pre><code>&lt;?php

// create database
$db = new \MicroDB\Database('data');

// create index
// maps the "email" attribute of any data object
// updates itself whenever an object is saved or deleted
$emailIndex = new \MicroDB\Index($db, 'email', 'email');

// ...

// using the index, you can quickly find items
// this is faster than using $db->find(array('email' => 'foo@bar.de'));
$foo = $emailIndex->first('foo@bar.de');

// let's create a more complex index
// this index keeps track of the number of posts by a user
$postsIndex = new \MicroDB\Index($db, 'number', function($data) use ($db) {
	// assuming that posts are stored inside user (not recommended, of course)
	return count($data['posts']);
});

// then we can find all users with at least 100 posts
$users = $postsIndex->find(function($key) { return $key >= 100; });
</code></pre>

<p>Note that the <code>Database</code> class does not use <code>Index</code> directly. Indices
work by listening to <a href="#events">database events</a> and are
stored as database objects.</p>

		</section>
		
		<section id="events" class="guide">
			
<h2>Events</h2>
<p>The following events (arguments in parentheses) are triggered by MicroDB:</p>

<pre>beforeSave ($id, $data)
saved ($id, $data)
beforeLoad ($id)
loaded ($id, $data)
beforeDelete ($id)
deleted ($id)</pre>

<div class="alert alert-info">Note that IDs starting with an underscore
are not getting any of these events because they are considered
hidden, e.g. index data files.</div>

<p>For example, the following code prevents modifications on user
objects unless you are an admin:</p>
				
<pre><code>&lt;?php

$db->on('beforeSave, beforeDelete', function($id, $data) use ($app) {
	if($data['type'] === 'user' && !$app->isAdmin())
		throw new \Exception(
			'Sorry, only admins are allowed to modify user data.'
		);
});</code></pre>

<p>You can also trigger events manually and unbind handlers:</p>

<pre><code>&lt;?php

$handler = function($arg) {
	echo $arg;
};

// bind to custom event
$db->on('hello', $handler);

// trigger an event with arguments
$db->trigger('hello', 'Hello World');

// unbind a specific handler
$db->off($handler);

// unbind all handlers of an event
$db->off('hello');</code></pre>
		
		</section>
		
		<section id="tests" class="guide">
			<h2>Tests</h2>
			<p>Before running the tests you must run <code>composer update</code> in the microdb
directory. This will install development dependencies like PHPUnit. Then, you can run
the tests with <code>vendor/bin/phpunit tests</code>.</p>

			<p>To test the concurrent behavior you can run the tests twice in parallel:
 <code>vendor/bin/phpunit tests &amp; vendor/bin/phpunit tests</code></p>
				
		</section>
		
		<section id="Database" class="class">			
			<h2>MicroDB\Database</h2>
			<p>Represents a database in a single path.</p>
			
			<p>TODO</p>
			
			<h3>Members</h3>
			<p><code>$db->caching</code> Is caching enabled? Defaults to <code>true</code>.
			
			<h3>Methods</h3>
			
			<p><code>__construct($dir)</code></p>
			<p>Constructor. Creates a database in the given directory.</p>
		</section>
		
		<section id="Index" class="class">
			<h2>MicroDB\Index</h2>
			<p>TODO</p>
		</section>
	</main>

	<footer id="footer" role="contentinfo">
		MicroDB is &copy; 2014 Morris Brodersen &middot; <a href="http://morrisbrodersen.de" target="_blank">morrisbrodersen.de</a>
	</footer>
</div>

	<script src="js/jquery-2.1.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/main.js"></script>
	
	<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
